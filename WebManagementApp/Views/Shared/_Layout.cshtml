@{
    var token = Context.Session.GetString("Token");
}

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <!-- Favicons -->
    <link href="~/assets/img/newlogo.jpg" rel="icon">
    <link href="assets/img/apple-touch-icon.png" rel="apple-touch-icon">



    <title>@ViewData["Title"] | Greenwize</title>
    
    <partial name="_PluginStylesPartial" />

    <!-- Handler for local scripts -->
    @RenderSection("Styles", required: false)

</head>
<body>
    <header id="header" class="header fixed-top d-flex align-items-center">
        <div class="d-flex align-items-center justify-content-between">
            <a href="" class="logo d-flex justify-content-center">
                <img src="~/assets/img/newlogo.jpg" alt="" style="max-height: 60px;">
            </a>
            <i class="bi bi-list toggle-sidebar-btn"></i>
        </div><!-- End Logo -->
        <nav class="header-nav ms-auto">
            <ul class="d-flex align-items-center">
                <li class="nav-item dropdown pe-3">
                    <a class="nav-link nav-profile d-flex align-items-center pe-0" href="#" data-bs-toggle="dropdown">
                        <img src="~/assets/img/noimage.png" alt="Profile" class="rounded-circle">
                        
                        @{
                            var name = Context.Session.GetString("Name");
                            <span class="d-none d-md-block dropdown-toggle ps-2">@name</span>
                        }
                        
                    </a><!-- End Profile Iamge Icon -->

                    <ul class="dropdown-menu dropdown-menu-end dropdown-menu-arrow profile">
                        <li class="dropdown-header">
                            <h6>@name</h6>
                        </li>
                        <li>
                            <hr class="dropdown-divider">
                        </li>
                        <li>
                            <a class="dropdown-item d-flex align-items-center" href="@Url.ActionLink("Logout", "User")">
                                <i class="bi bi-box-arrow-right"></i>
                                <span>Log out</span>
                            </a>
                        </li>

                    </ul><!-- End Profile Dropdown Items -->
                </li><!-- End Profile Nav -->

            </ul>
        </nav><!-- End Icons Navigation -->
    </header>

    <aside id="sidebar" class="sidebar position-fixed">
        <ul class="sidebar-nav" id="sidebar-nav">
            <li class="nav-item">
                <a class="nav-link collapsed" asp-controller="Dashboard" asp-action="Index">
                    <i class="bi bi-grid"></i><span>Dashboard</span>
                </a>
            </li>
            <li class="nav-item">
                <a class="nav-link collapsed" data-bs-target="#masterPage-nav" data-bs-toggle="collapse" href="#">
                    <i class="bi bi-folder"></i><span>Master Page</span><i class="bi bi-chevron-down ms-auto"></i>
                </a>
                <ul id="masterPage-nav" class="nav-content collapse" data-bs-parent="#sidebar-nav">
                    <li>
                        <a class="nav-link" asp-controller="Brand" asp-action="Index">
                            <i class="bi bi-circle"></i><span>Brand Page</span>
                        </a>
                    </li>
                    <li>
                        <a class="nav-link" asp-controller="Category" asp-action="Index">
                            <i class="bi bi-circle"></i><span>Category Page</span>
                        </a>
                    </li>
                    <li>
                        <a class="nav-link" asp-controller="Supplier" asp-action="Index">
                            <i class="bi bi-circle"></i><span>Supplier Page</span>
                        </a>
                    </li>
                    
                    <li>
                        <a class="nav-link" asp-controller="ShippingLabel" asp-action="Index">
                            <i class="bi bi-circle"></i><span>Shipping Label Page</span>
                        </a>
                    </li>
                </ul>
            </li>
            <li class="nav-item">
                <a class="nav-link collapsed" data-bs-target="#masterSKU-nav" data-bs-toggle="collapse" href="#">
                    <i class="bi bi-menu-button-wide"></i><span>Master Product</span><i class="bi bi-chevron-down ms-auto"></i>
                </a>
                <ul id="masterSKU-nav" class="nav-content collapse" data-bs-parent="#sidebar-nav">
                    <li>
                        <a class="nav-link" asp-controller="MasterSKU" asp-action="Index">
                            <i class="bi bi-circle"></i><span>Add Product</span>
                        </a>
                    </li>
                    <li>
                        <a class="nav-link" asp-controller="ProductList" asp-action="Index">
                            <i class="bi bi-circle"></i><span>Product List</span>
                        </a>
                    </li>
                </ul>
            </li>

            <li class="nav-item">
                <a class="nav-link collapsed" data-bs-target="#mapping-nav" data-bs-toggle="collapse" href="#">
                    <i class="bi bi-layout-text-window-reverse"></i><span>Product Mapping</span><i class="bi bi-chevron-down ms-auto"></i>
                </a>
                <ul id="mapping-nav" class="nav-content collapse" data-bs-parent="#sidebar-nav">
                    <li>
                        <a class="nav-link" asp-controller="MappingSKU" asp-action="Index">
                            <i class="bi bi-circle"></i><span>SKU Mapping</span>
                        </a>
                    </li>
                    <li>
                        <a class="nav-link" asp-controller="MappingSKU" asp-action="Bundle">
                            <i class="bi bi-circle"></i><span>Bundle Mapping</span>
                        </a>
                    </li>
                </ul>
            </li>

            <li class="nav-item">
                <a class="nav-link collapsed" data-bs-target="#inventory-nav" data-bs-toggle="collapse" href="#">
                    <i class="bi bi-journals"></i><span>Inventory</span><i class="bi bi-chevron-down ms-auto"></i>
                </a>
                <ul id="inventory-nav" class="nav-content collapse" data-bs-parent="#sidebar-nav">
                    <li>
                        <a class="nav-link" asp-controller="MasterInventory" asp-action="Index">
                            <i class="bi bi-circle"></i><span>Master Inventory</span>
                        </a>
                    </li>
                    <li>
                        <a class="nav-link" asp-controller="Inventory" asp-action="MarketplaceInventory">
                            <i class="bi bi-circle"></i><span>Marketplace Inventory</span>
                        </a>
                    </li>
                    <li>
                        <a class="nav-link" asp-controller="InventorySync" asp-action="Index">
                            <i class="bi bi-circle"></i><span>Sync Inventory</span>
                        </a>
                    </li>                    
                </ul>
            </li>
            <li class="nav-item">
                <a class="nav-link collapsed" asp-controller="Sales" asp-action="Index">
                    <i class="bi bi-bar-chart"></i><span>Sales Page</span>
                </a>
            </li><!-- End Profile Page Nav -->

            <li class="nav-item">
                <a class="nav-link collapsed" data-bs-target="#purchaseOrder-nav" data-bs-toggle="collapse" href="#">
                    <i class="bi bi-receipt"></i><span>Purchase Order</span><i class="bi bi-chevron-down ms-auto"></i>
                </a>
                <ul id="purchaseOrder-nav" class="nav-content collapse" data-bs-parent="#sidebar-nav">
                    <li>
                        <a class="nav-link" asp-controller="PurchaseOrder" asp-action="Index">
                            <i class="bi bi-circle"></i><span>Create Purchase Order</span>
                        </a>
                    </li>                     
                    <li>
                        <a class="nav-link" asp-controller="PurchaseOrder" asp-action="PurchaseOrder">
                            <i class="bi bi-circle"></i><span>Purchase Order</span>
                        </a>
                    </li>
                    <li>
                        <a class="nav-link" asp-controller="PurchaseOrder" asp-action="InventoryClaims">
                            <i class="bi bi-circle"></i><span>Inventory Claims</span>
                        </a>
                    </li>
                    <li>
                        <a class="nav-link" asp-controller="PurchaseOrder" asp-action="StockReceiptReport">
                            <i class="bi bi-circle"></i><span>Stock Receipt Report</span>
                        </a>
                    </li>
                    <li>
                        <a class="nav-link" asp-controller="PurchaseOrder" asp-action="StockAgingReport">
                            <i class="bi bi-circle"></i><span>Stock Aging Report</span>
                        </a>
                    </li>
                </ul>
            </li><!-- End Purchase Order Page Nav -->

            <li class="nav-item">
                <a class="nav-link collapsed" data-bs-target="#reporting-nav" data-bs-toggle="collapse" href="#">
                    <i class="bi bi-file-earmark-text"></i><span>Reports</span><i class="bi bi-chevron-down ms-auto"></i>
                </a>
                <ul id="reporting-nav" class="nav-content collapse" data-bs-parent="#sidebar-nav">
                    <li>
                        <a class="nav-link" asp-controller="Reporting" asp-action="MarginReport">
                            <i class="bi bi-circle"></i><span>Margin Report</span>
                        </a>
                    </li>
                    <li>
                        <a class="nav-link" asp-controller="Reporting" asp-action="Index">
                            <i class="bi bi-circle"></i><span>Stock by Location and Cost</span>
                        </a>
                    </li>
                    <li>
                        <a class="nav-link" asp-controller="Reporting" asp-action="StockInhandAndFBA">
                            <i class="bi bi-circle"></i><span>Stock Inhand & FBA</span>
                        </a>
                    </li>
                    <li>
                        <a class="nav-link" asp-controller="Reporting" asp-action="StockAgingReport">
                            <i class="bi bi-circle"></i><span>Stock Aging Report</span>
                        </a>
                    </li> 
                    <li>
                        <a class="nav-link" asp-controller="Reporting" asp-action="BtoBStockReport">
                            <i class="bi bi-circle"></i><span>BtoB Stock Report</span>
                        </a>
                    </li>
                    <li>
                        <a class="nav-link" asp-controller="Reporting" asp-action="MinimumPriceReport">
                            <i class="bi bi-circle"></i><span>Minimum Price Report</span>
                        </a>
                    </li>
                    <li>
                        <a class="nav-link" asp-controller="Reporting" asp-action="MasterStockActivityReport">
                            <i class="bi bi-circle"></i><span>Master Stock Activity Report</span>
                        </a>
                    </li>
                    <li>
                        <a class="nav-link" asp-controller="Reporting" asp-action="MasterCostActivityReport">
                            <i class="bi bi-circle"></i><span>Master Cost Activity Report</span>
                        </a>
                    </li>
                </ul>
            </li> 
            <li class="nav-item">
                <a class="nav-link collapsed" data-bs-target="#Settings-nav" data-bs-toggle="collapse" href="#">
                    <i class="bi bi-gear"></i><span>Settings</span><i class="bi bi-chevron-down ms-auto"></i>
                </a>
                <ul id="Settings-nav" class="nav-content collapse" data-bs-parent="#sidebar-nav">
                    @{
                        var userRole = Context.Session.GetString("UserRole");
                    }
                    @if (userRole == "admin")
                    {
                        <li>
                            <a class="nav-link" asp-controller="ManageUser" asp-action="Index">
                                <i class="bi bi-circle"></i><span>Manage User</span>
                            </a>
                        </li>
                    }
                    <li>
                        <a class="nav-link" asp-controller="Settings" asp-action="CurrencyRate">
                            <i class="bi bi-circle"></i><span>Currency Rate</span>
                        </a>
                    </li>
                </ul>
                
            </li>   
        </ul>

    </aside><!-- End Sidebar-->
    <!-- Content Wrapper. Contains page content -->
    <main id="main" class="main">
        <div class="pagetitle">
            <h1>@ViewData["Title"]</h1>
        </div>
        <!-- Main content -->
        <section class="section">

            <div class="row">
                <div class="col-lg-12">
                    @RenderBody()
                </div>
            </div>
        </section>
    </main>

    <partial name="_PluginScriptsPartial" />

    <partial name="_ValidationScriptsPartial" />

    @await RenderSectionAsync("Scripts", required: false)
    <script>

        // document.addEventListener("DOMContentLoaded", function () {
        //     // Get the current URL path
        //     var url = new URL(window.location.href);
        //     var params = url.search;

        //     var path = window.location.pathname.toLowerCase();

        //     // Get all navigation links
        //     var navLinks = document.querySelectorAll('.nav-link');
           
        //     // Loop through all navigation links
        //     navLinks.forEach(function (navLink) {
        //         // Get the href attribute
        //         var href = navLink.getAttribute('href');
        //         if (href) {
        //             href = href.toLowerCase();
        //             // Check if the href matches the current path exactly
        //             // if (path === href && params == "") {
        //             if (path === href) {
                       
        //                 // Add the 'active' class to the current nav-link
        //                 navLink.classList.add('active');

        //                 // Find the parent collapsible menu and add the 'show' class
        //                 var parentNavContent = navLink.closest('.nav-content');
        //                 if (parentNavContent) {
        //                     parentNavContent.classList.add('show');
        //                     // Find the corresponding nav-link and remove 'collapsed' class
        //                     var parentNavLink = parentNavContent.previousElementSibling;
        //                     if (parentNavLink) {
        //                         parentNavLink.classList.remove('collapsed');
        //                     }
        //                 }

        //             } else {
        //                 // Ensure that links that do not match the current path are not active
        //                 navLink.classList.remove('active');
        //             }
        //         }
        //     });
            
        // });
        document.addEventListener("DOMContentLoaded", function () {
            // Get the current URL path
            var path = window.location.pathname.toLowerCase();

            // Function to normalize the path by removing trailing slashes
            function normalizePath(p) {
                return p.replace(/\/$/, "");  // Remove trailing slash if present
            }

            // Normalize the current path
            path = normalizePath(path);

            // Get all navigation links
            var navLinks = document.querySelectorAll('.nav-link');

            // Loop through all navigation links
            navLinks.forEach(function (navLink) {
                // Get the href attribute
                var href = navLink.getAttribute('href');
                if (href) {
                    // Normalize the href path
                    href = normalizePath(href.toLowerCase());

                    // Check if the href matches the current path exactly
                    if (path === href) {
                        // Add the 'active' class to the current nav-link
                        navLink.classList.add('active');

                        // If the link is inside a collapsible menu, expand the menu
                        var parentNavContent = navLink.closest('.nav-content');
                        if (parentNavContent) {
                            parentNavContent.classList.add('show');
                            // Find the corresponding nav-link and remove 'collapsed' class
                            var parentNavLink = parentNavContent.previousElementSibling;
                            if (parentNavLink) {
                                
                                parentNavLink.classList.remove('collapsed');
                            }
                        }
                        else {
                            navLink.classList.remove('collapsed');
                        }
                    } else {
                        // Ensure that links that do not match the current path are not active
                        navLink.classList.remove('active');
                    }
                }
            });
        });

        /* Always logs out the user after 60 minute (if no activity) */
        const idleLimit = 60 * 60 * 1000; // 60 minutes in ms
        let lastActivity = Date.now();

        // Reset on user activity and sync across tabs
        function resetIdleTime() {
            lastActivity = Date.now();
            localStorage.setItem("lastActivity", lastActivity);
        }

        // Unified storage listener
        window.addEventListener("storage", (e) => {
            if (e.key === "lastActivity" && e.newValue) {
                lastActivity = parseInt(e.newValue, 10);
            }
            if (e.key === "forceLogout") {
                window.location.href = "/"; // logout all tabs
            }
        });

        // Check every minute
        setInterval(() => {
            if (Date.now() - lastActivity >= idleLimit) {
                localStorage.setItem("forceLogout", Date.now()); // notify all tabs
                window.location.href = "/";
            }
        }, 60000);

        // Track multiple user activity events
        ["mousemove", "keypress", "click", "scroll", "touchstart"].forEach(evt => {
            document.addEventListener(evt, resetIdleTime);
        });
        /* Auto logs out end */
     
    </script>
</body>
</html>
